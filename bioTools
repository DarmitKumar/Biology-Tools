import webbrowser


def formata(nome_ficheiro: str, imprime=False) -> str:
    """
    remove símbolos, espaços e parágrafos desnecessários

    Se imprime=True então também imprime as alterações no ficheiro, default=False


    :param nome_ficheiro:
    :param imprime:
    :return:
    """

    with open(nome_ficheiro, 'r') as f:  # abre o ficheiro
        txt = f.readlines()
    primeiro = True
    txtf = ''
    for linha in txt:
        if linha.startswith('>') and primeiro:
            primeiro = False
            txtf += str(linha)
        elif linha.startswith('>') and not primeiro:
            txtf += str(linha.replace('>', '\n>'))
        else:
            txtf += str(linha.strip('\n'))

    for letra in txtf:
        if not letra.isdigit() and not letra.isalpha() and letra != '>' and not letra.isspace():
            txtf = txtf.replace(letra, '_')
        txtf = txtf.replace(' ', '_')

    if imprime:
        with open(nome_ficheiro, 'w') as g:
            g.write(txtf)
    return txtf


def nomes(nome_ficheiro: str, string=True) -> str:
    """
    Analisa o ficheiro e retorna uma lista com o nome das sequências, por default, no formato str

    Se string=False, então retorna no formato lista


    :param nome_ficheiro:
    :param string:
    :return:
    """

    with open(nome_ficheiro, 'r', encoding='utf-8') as f:
        f = f.readlines()
    lista = []
    for linha in f:
        linha = linha.split()
        lista.append(linha[0])
    if string:
        lista = ', '.join(lista)
    return lista


def ncbi_search(string1: str, string2: str):
    """
    recebe dois termos e faz a pesquisa utilizando o operador AND na base de dados NCBI

    Abre o resultado na página do browser

    :param string1:
    :param string2:
    :return:
    """

    url = 'https://www.ncbi.nlm.nih.gov/search/all/?term=' + string1 + '+and+' + string2
    webbrowser.open_new_tab(url)
    
    
    def accesser_re(nome_ficheiro: str, delimitador='_', num_campos=3) -> list:
    """
    retorna lista de accesser number para o nome de cada sequência do ficheiro no formato de uma lista


    :param nome_ficheiro:
    :param delimitador:
    :param num_campos:
    :return:
    """
    lista_nomes = nomes(nome_ficheiro, False)
    lista_accesser=[]
    accesser = ''
    campos_vistos = 0
    for entrada in lista_nomes:
        for caracter in entrada:
            if caracter != delimitador:
                accesser += caracter
            else:
                campos_vistos += 1
                if campos_vistos == num_campos:
                    break
                else:
                    accesser += caracter
        lista_accesser.append(accesser)
        accesser = ''
        campos_vistos = 0
    return lista_accesser
